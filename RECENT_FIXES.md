# æœ€è¿‘ä¿®å¤è®°å½• (2025-12-24)

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ğŸ”¤ å¢å¤§å¯¹è¯å­—ä½“ï¼Œä¼˜åŒ–ç§»åŠ¨ç«¯UI

**æ–‡ä»¶**: `src/phaser/dialog/DialogUIManager.js`

**ä¿®æ”¹å†…å®¹**:
- **å¯¹è¯æ–‡å­—**: 
  - æ‰‹æœºç«¯ï¼š24-28pxï¼ˆä¹‹å‰16-20pxï¼‰
  - PCç«¯ï¼š26-32px
  - å¢åŠ è¡Œè·ä»8pxåˆ°12px
  - å¢å¼ºæè¾¹ä»1pxåˆ°2px
  - ä¼˜åŒ–å­—ä½“åˆ—è¡¨ï¼Œæ·»åŠ ä¸­æ–‡å­—ä½“æ”¯æŒ

- **æŒ‰é’®å­—ä½“**:
  - æ‰‹æœºç«¯ï¼š20px
  - PCç«¯ï¼š22px
  - å¢å¤§æŒ‰é’®paddingï¼ˆx: 25, y: 15ï¼‰
  - ä¼˜åŒ–hoveræ•ˆæœï¼ˆscale: 1.08ï¼‰

---

### 2. ğŸ“ ä¸ºæ¯ä¸ªé—®é¢˜æ·»åŠ "å…¶ä»–"é€‰é¡¹+è¾“å…¥æ¡†

**æ–‡ä»¶**: 
- `src/phaser/dialog/MealRecordingHandler.js`
- `src/phaser/dialog/DialogUIManager.js`
- `src/phaser/dialog/DialogSceneRefactored.js`

**ä¿®æ”¹å†…å®¹**:

#### MealRecordingHandler.js
```javascript
// ä¿®æ”¹å‰ï¼šè¿”å›å­—ç¬¦ä¸²æ•°ç»„
getQuestionOptions(questionId, language = "en") {
  return ["Rice", "Noodles", ...];
}

// ä¿®æ”¹åï¼šè¿”å›å¯¹è±¡æ•°ç»„ï¼ŒåŒ…å«"å…¶ä»–"é€‰é¡¹
getQuestionOptions(questionId, language = "en") {
  return [
    { text: "Rice", value: "Rice", isOther: false },
    ...
    { text: "å…¶ä»–/Other", value: "other", isOther: true }
  ];
}
```

#### DialogUIManager.js
- æ–°å¢ `showInputBox(callback)` æ–¹æ³•
- å½“ç”¨æˆ·ç‚¹å‡»"å…¶ä»–"é€‰é¡¹æ—¶ï¼Œæ˜¾ç¤ºè¾“å…¥æ¡†
- è¾“å…¥æ¡†æ ·å¼ï¼š
  - è‡ªé€‚åº”å®½åº¦ï¼ˆæ‰‹æœº80%ï¼ŒPC 500pxï¼‰
  - å¤§å­—ä½“ï¼ˆæ‰‹æœº20pxï¼ŒPC 22pxï¼‰
  - ç´«è‰²è¾¹æ¡†ï¼Œæš—è‰²èƒŒæ™¯
  - æ”¯æŒå›è½¦æäº¤

#### DialogSceneRefactored.js
- ç§»é™¤é€‰é¡¹æ˜ å°„é€»è¾‘ï¼ˆoptionså·²æ˜¯å¯¹è±¡æ•°ç»„ï¼‰
- ä¿®å¤ `askedQuestions` ç±»å‹é”™è¯¯ï¼ˆæ”¹ç”¨ `Set`ï¼‰

---

### 3. ğŸ’¾ ä¿®å¤çº¿ç´¢ä¿å­˜å¤±è´¥çš„é—®é¢˜

**æ–‡ä»¶**: `server/routes/gameRoutes.js`

**é—®é¢˜**: 
- ä¹‹å‰æ‰€æœ‰é¤é£Ÿï¼ˆæ—©ä¸­æ™šï¼‰éƒ½ä¼šè§¦å‘çº¿ç´¢ä¿å­˜
- å¯¼è‡´æ•°æ®åº“æœ‰ä¸å¿…è¦çš„é‡å¤è®°å½•

**ä¿®å¤**:
```javascript
// ä¿®æ”¹å‰
if (["breakfast", "lunch", "dinner"].includes(mealType)) {
  shouldGiveClue = true; // âŒ æ‰€æœ‰é¤éƒ½ç»™çº¿ç´¢
  clueText = getClueForNPCStage(...);
}

// ä¿®æ”¹å
if (mealType === "dinner") {
  shouldGiveClue = true; // âœ… åªæœ‰æ™šé¤ç»™çº¿ç´¢
  clueText = getClueForNPCStage(...);
  console.log(`âœ… [æ™šé¤] ç»™äºˆçº¿ç´¢`);
} else {
  console.log(`â„¹ï¸ [${mealType}] ä¸ç»™çº¿ç´¢ï¼Œå‰ç«¯å°†æ˜¾ç¤ºvagueå›å¤`);
}
```

---

### 4. ğŸ¯ ä¿®å¤vague/çº¿ç´¢é€»è¾‘

**æ–‡ä»¶**: `src/phaser/dialog/DialogSceneRefactored.js`

**ä¿®æ”¹å†…å®¹**:
```javascript
// å¢å¼ºåˆ¤æ–­é€»è¾‘å’Œæ—¥å¿—
if (this.stateManager.selectedMealType === "dinner" && result.shouldGiveClue) {
  await this.giveClue(); // æ™šé¤ + åç«¯ç¡®è®¤ = çº¿ç´¢
} else if (this.stateManager.selectedMealType !== "dinner") {
  await this.giveVagueResponse(); // éæ™šé¤ = vagueå›å¤
}
```

**Vagueå›å¤é€»è¾‘**:
- ç¬¬1æ¬¡ï¼šé•¿å›å¤ï¼ˆå…³äºåå¸ˆå‚…å’Œé£Ÿæï¼‰
- ç¬¬2æ¬¡åŠä»¥åï¼šçŸ­å›å¤ï¼ˆå…³äºé’æœ¨ç±½ï¼‰

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. é‡å¯æœåŠ¡å™¨
```bash
# Terminal 1 - åç«¯
cd server
npm start

# Terminal 2 - å‰ç«¯
cd Food-Tracking
npm start
```

### 2. æµ‹è¯•æµç¨‹

1. **ç™»å½•**: è¾“å…¥ `001`
2. **é€‰æ‹©æ€§åˆ«**: ç‚¹å‡»ç”·å­©/å¥³å­©
3. **ç‚¹å‡»ç¬¬ä¸€ä¸ªNPC** (æ‘é•¿)
4. **æŸ¥çœ‹å­—ä½“**: 
   - âœ… å¯¹è¯æ–‡å­—åº”è¯¥æ›´å¤§æ›´æ¸…æ™°
   - âœ… æŒ‰é’®å­—ä½“åº”è¯¥æ›´å¤§
5. **é€‰æ‹©é¤é£Ÿ**: ç‚¹å‡» "Breakfast" ï¼ˆæ—©é¤ï¼‰
6. **å›ç­”é—®é¢˜**:
   - âœ… æ¯ä¸ªé—®é¢˜åº”è¯¥æœ‰"å…¶ä»–/Other"é€‰é¡¹
   - âœ… ç‚¹å‡»"å…¶ä»–"åº”è¯¥å¼¹å‡ºè¾“å…¥æ¡†
   - âœ… è¾“å…¥æ¡†åº”è¯¥æ”¯æŒå›è½¦æäº¤
7. **å®Œæˆè®°å½•**: 
   - âœ… çœ‹åˆ° "Thanks for sharing..."
   - âœ… **åº”è¯¥çœ‹åˆ°vagueå›å¤**ï¼ˆéæ™šé¤ï¼‰
8. **å†æ¬¡ç‚¹å‡»NPCï¼Œé€‰æ‹© "Dinner"**:
   - âœ… å›ç­”æ‰€æœ‰é—®é¢˜
   - âœ… **åº”è¯¥çœ‹åˆ°çº¿ç´¢**ï¼ˆæ™šé¤ï¼‰
   - âœ… æ£€æŸ¥æ§åˆ¶å°ï¼šåº”è¯¥æœ‰ `âœ… [æ™šé¤] ç»™äºˆçº¿ç´¢` æ—¥å¿—

---

## ğŸ“± ç§»åŠ¨ç«¯æµ‹è¯•

### Chrome DevTools
1. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
2. ç‚¹å‡»å·¦ä¸Šè§’è®¾å¤‡å›¾æ ‡ï¼ˆToggle device toolbarï¼‰
3. é€‰æ‹© `iPhone 12 Pro` æˆ–å…¶ä»–æ‰‹æœº
4. æµ‹è¯•å­—ä½“å¤§å°å’ŒUIäº¤äº’

### æœŸæœ›ç»“æœ
- âœ… å­—ä½“åœ¨æ‰‹æœºä¸Šæ¸…æ™°å¯è¯»
- âœ… æŒ‰é’®æ˜“äºç‚¹å‡»ï¼ˆè¶³å¤Ÿå¤§ï¼‰
- âœ… è¾“å…¥æ¡†æ˜¾ç¤ºæ­£ç¡®
- âœ… "å…¶ä»–"é€‰é¡¹åŠŸèƒ½æ­£å¸¸

---

## ğŸ› å·²çŸ¥é—®é¢˜ï¼ˆå¦‚æœ‰ï¼‰

ç›®å‰æš‚æ— å·²çŸ¥é—®é¢˜ã€‚å¦‚æœæµ‹è¯•æ—¶å‘ç°é—®é¢˜ï¼Œè¯·å¤åˆ¶**æ§åˆ¶å°é”™è¯¯ä¿¡æ¯**å’Œ**å…·ä½“å¤ç°æ­¥éª¤**ã€‚

---

## ğŸ“‚ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

- `src/phaser/dialog/DialogUIManager.js` âœ…
- `src/phaser/dialog/MealRecordingHandler.js` âœ…
- `src/phaser/dialog/DialogSceneRefactored.js` âœ…
- `server/routes/gameRoutes.js` âœ…

---

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

1. **é€‰é¡¹æ ¼å¼**: ä»å­—ç¬¦ä¸²æ•°ç»„æ”¹ä¸ºå¯¹è±¡æ•°ç»„
2. **è¾“å…¥æ¡†**: ä½¿ç”¨HTML inputå…ƒç´ ï¼ŒåŠ¨æ€åˆ›å»ºå’Œé”€æ¯
3. **å­—ä½“è‡ªé€‚åº”**: æ ¹æ®å±å¹•å®½åº¦è®¡ç®—å­—ä½“å¤§å°
4. **çº¿ç´¢é€»è¾‘**: åç«¯åˆ¤æ–­ + å‰ç«¯å±•ç¤ºåˆ†ç¦»
5. **æ—¥å¿—å¢å¼º**: æ¯ä¸ªå…³é”®æ­¥éª¤éƒ½æœ‰console.log

